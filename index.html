<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hyrox Challenge</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #000000;
            color: #FFED00;
            min-height: 100vh;
            padding: 20px;
            font-weight: 600;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            font-size: 40px;
            margin-bottom: 40px;
            text-align: center;
            text-transform: uppercase;
            background: #FFED00;
            color: #000000;
            padding: 20px;
        }

        .home-page, .challenge-page {
            display: none;
        }

        .home-page.active, .challenge-page.active {
            display: block;
        }

        /* Home Page Styles */
        .form-section {
            margin-bottom: 24px;
        }

        .section-title {
            background: #FFED00;
            color: #000000;
            padding: 4px 8px;
            margin-bottom: 12px;
            font-size: 14px;
            text-transform: uppercase;
            width: fit-content;
        }

        .form-group {
            margin-bottom: 12px;
        }

        label {
            display: none;
        }

        input, select {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-weight: 600;
            background: #000000;
            color: #FFFFFF80;
            border: 1px solid #333333;
            border-radius: 0;
        }

        button {
            padding: 16px;
            font-size: 20px;
            font-weight: 600;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            cursor: pointer;
            border-radius: 0;
            text-transform: uppercase;
        }

        .btn-primary {
            background: #FFED00;
            color: #000000;
            border: 1px solid #FFED00;
            width: 100%;
        }

        .btn-primary:hover {
            opacity: 0.9;
        }

        @media (max-width: 600px) {
            .btn-primary {
                margin-top: 16px;
            }
        }

        .link-container {
            display: none;
            margin-top: 28px;
            padding: 20px;
            border: 1px solid #FFED00;
        }

        .link-container.active {
            display: block;
        }

        .link-title {
            background: #FFED00;
            color: #000000;
            padding: 8px 12px;
            margin-bottom: 12px;
            font-size: 16px;
            text-transform: uppercase;
        }

        .link-display {
            background: #000000;
            border: 1px solid #333333;
            padding: 12px;
            margin-bottom: 12px;
            word-break: break-all;
            font-size: 14px;
            color: #FFED00;
        }

        .btn-copy {
            background: #000000;
            color: #FFED00;
            border: 1px solid #FFED00;
            width: 100%;
            padding: 12px;
            margin-bottom: 8px;
        }

        .btn-copy:hover {
            background: #FFED00;
            color: #000000;
        }

        /* Challenge Page Styles */
        .timer-display {
            text-align: center;
            font-size: 18px;
            margin-bottom: 20px;
            padding: 12px;
            border: 1px solid #FFED00;
            background: #FFED00;
            color: #000000;
        }

        .penalty-board {
            border: 1px solid #FFED00;
            padding: 20px;
            margin-bottom: 28px;
            min-height: 152px;
        }

        .penalty-board h3 {
            color: #000000;
            background: #FFED00;
            padding: 8px 12px;
            margin-bottom: 12px;
            font-size: 18px;
            text-transform: uppercase;
            width: fit-content;
        }

        .penalty-item {
            font-size: 14px;
            margin-bottom: 4px;
            animation: slideIn 0.3s ease;
            color: #FFFFFF;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-8px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .challenge-message {
            text-align: center;
            font-size: 20px;
            margin: 40px 0;
            line-height: 1.6;
            border: 1px solid #FFED00;
            padding: 20px;
        }

        .quiz-container {
            margin: 40px 0;
        }

        .quiz-question {
            text-align: center;
            font-size: 20px;
            margin-bottom: 28px;
            line-height: 1.6;
            color: #FFFFFF;
        }

        .quiz-options {
            display: flex;
            flex-direction: row;
            gap: 12px;
            max-width: 600px;
            margin: 0 auto;
            justify-content: space-evenly;
        }
        
        .quiz-option {
            background: #FFED00;
            color: #000000;
            border: 1px solid #FFED00;
            padding: 12px;
            font-size: 18px;
            font-weight: 600;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            cursor: pointer;
            text-transform: uppercase;
            transition: all 0.2s ease;
        }
        
        .quiz-option:hover {
            background: #000000;
            color: #FFED00;
        }

        .buttons-container {
            position: relative;
            display: flex;
            justify-content: center;
            gap: 28px;
            margin: 40px 0;
            min-height: 100px;
            align-items: center;
            display: none;
        }

        .btn-yes {
            background: #FFED00;
            color: #000000;
            border: 1px solid #FFED00;
            padding: 12px 40px;
            font-size: 20px;
            width: auto;
            position: relative;
        }

        .btn-no {
            background: #000000;
            color: #FFED00;
            border: 1px solid #FFED00;
            padding: 12px 40px;
            font-size: 20px;
            position: fixed;
            width: auto;
        }

        .funny-message {
            text-align: center;
            font-size: 18px;
            margin-top: 20px;
            min-height: 40px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .completion-page {
            display: none;
            text-align: center;
        }

        .completion-page.active {
            display: block;
        }

        .completion-message {
            font-size: 20px;
            margin: 40px 0;
            line-height: 1.8;
            color: #FFFFFF;
        }

        .highlight {
            background: #FFED00;
            color: #000000;
            padding: 0px 12px 8px 4px;
        }

        .share-link {
            background: #000000;
            border: 1px solid #FFED00;
            padding: 12px;
            margin: 28px 0;
            font-size: 14px;
            line-height: 1.6;
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 28px;
            }

            .challenge-message {
                font-size: 18px;
            }

            .btn-yes, .btn-no {
                padding: 12px 32px;
                font-size: 16px;
            }
        }

        .time-predicted {
            background: #FFED00;
            color: #000000;
            padding: 0 12px 8px 4px;
            font-size: 24px;
        }
    </style>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5G0PG5JLYX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-5G0PG5JLYX', {
        'send_page_view': false
      });
    
      function trackPage(pageName, pageTitle) {
        gtag('event', 'page_view', {
          page_title: pageTitle,
          page_location: window.location.href,
          page_path: '/' + pageName
        });
      }

      function trackEvent(eventName, params = {}) {
        gtag('event', eventName, params);
      }
    </script>
</head>
<body>
    <!-- HOME PAGE -->
    <div class="home-page active">
        <div class="container">
            <h1>Challenge your Hyrox partner! ðŸ’ª</h1>
            
            <form id="challengeForm">
                <div class="form-section">
                    <div class="section-title">Your Partner</div>
                    <div class="form-group">
                        <input type="text" id="recipient" required placeholder="Name">
                    </div>
                    <div class="form-group">
                        <input type="number" id="age" placeholder="Age">
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">You</div>
                    <div class="form-group">
                        <input type="text" id="sender" required placeholder="Your name">
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">Challenge</div>
                    <div class="form-group">
                        <select id="category" required>
                            <option value="">Select the category of your race</option>
                            <option value="women">Women</option>
                            <option value="men">Men</option>
                            <option value="mixed">Mixed</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <select id="exercise" required>
                            <option value="">Select the exercise you want to challenge your partner on</option>
                            <option value="burpees">Burpees</option>
                            <option value="push-ups">Push-ups</option>
                            <option value="squats">Squats</option>
                            <option value="plank">Plank</option>
                        </select>
                    </div>
                </div>

                <button type="submit" class="btn-primary">Send Challenge!</button>
            </form>

            <div class="link-container" id="linkContainer">
                <div class="link-title">Share this link with your partner</div>
                <div class="link-display" id="generatedLink"></div>
                <button class="btn-copy" id="copyBtn">Copy Link</button>
            </div>
        </div>
    </div>

    <!-- CHALLENGE PAGE -->
    <div class="challenge-page">
        <div class="container">
            <div class="timer-display" id="hyroxTimer">
                YOUR NEXT HYROX RACE TIME: 00:50:00
            </div>
            
            <div class="quiz-container">
                <div class="challenge-message" id="challengeText">
                    Answer this question and discover the [EXERCISE] challenge your partner [SENDER] sent you
                </div>
                <div class="quiz-question" id="quizQuestion">
                    Loading question...
                </div>
                <div class="quiz-options" id="quizOptions">
                </div>

                <div class="funny-message" id="funnyMessage"></div>
            </div>

            <div class="penalty-board">
                <h3>PENALTY BOARD</h3>
                <div id="penaltyList"></div>
                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #FFED00;">
                    TOTAL PENALTY REPS: <span id="penaltyCounter">0</span>
                </div>
            </div>

            
        </div>
    </div>

    <!-- COMPLETION PAGE -->
    <div class="completion-page">
        <div class="container">
            <div class="completion-message" id="completionText">
            </div>
            
            <div class="share-link" id="shareLink"></div>

            <button class="btn-primary" id="challengeBackBtn">
                Send a challenge to your partner
            </button>
        </div>
    </div>

    <script>
        // Global variables
        let challengeData = {
            recipient: '',
            sender: '',
            age: 0,
            category: '',
            exercise: 'burpees'
        };

        let timerInterval;
        let penaltyInterval;
        let hyroxSeconds = 50 * 60;
        let elapsedSeconds = 0;
        let totalReps = 0;
        let penaltyReps = 0;
        let penalties = [];
        let messageTimeout;
        let cycleStep = 0;

        const funnyMessages = [
            "Come on! You know you want to",
            "Don't let [SENDER] down!",
            "Yes is the only option",
            "Your Hyrox stats are waiting!",
            "The more you wait, the harder the challenge will be"
        ];

        const exerciseConfig = {
            'burpees': { increment: 1, unit: 'reps' },
            'push-ups': { increment: 1, unit: 'reps' },
            'squats': { increment: 5, unit: 'reps' },
            'plank': { increment: 10, unit: 'sec' }
        };

        const quizQuestions = [
            {
                question: "You need to complete 1000m on the SkiErg with a partner, split into 4 equal parts. How many meters does each athlete complete in total?",
                options: ["250m", "500m", "750m"],
                correct: "500m"
            },
            {
                question: "The 1000m on the RowErg are split into 4 alternating efforts. How many meters does each athlete row per round?",
                options: ["125m", "250m", "500m"],
                correct: "250m"
            },
            {
                question: "In the {{divisionLabel}} division, how much weight is used for the sled push?",
                options: {
                    women: ["78kg", "102kg", "125kg"],
                    men: ["152kg", "202kg", "227kg"],
                    mixed: ["152kg", "202kg", "227kg"]
                },
                correct: {
                    women: "102kg",
                    men: "152kg",
                    mixed: "152kg"
                }
            },
            {
                question: "In the {{divisionLabel}} division, how much weight is used for the sled pull?",
                options: {
                    women: ["78kg", "102kg", "125kg"],
                    men: ["103kg", "153kg", "202kg"],
                    mixed: ["103kg", "153kg", "202kg"]
                },
                correct: {
                    women: "78kg",
                    men: "153kg",
                    mixed: "153kg"
                }
            },
            {
                question: "The burpee broad jumps cover 80m total. If two athletes split the work evenly, how many meters does each athlete complete?",
                options: ["20m", "40m", "60m"],
                correct: "40m"
            },
            {
                question: "In the {{divisionLabel}} division, what is the farmer's carry weight?",
                options: {
                    women: ["2Ã—12kg", "2Ã—16kg", "2Ã—20kg"],
                    men: ["2Ã—24kg", "2Ã—28kg", "2Ã—32kg"],
                    mixed: ["2Ã—24kg", "2Ã—28kg", "2Ã—32kg"]
                },
                correct: {
                    women: "2Ã—16kg",
                    men: "2Ã—32kg",
                    mixed: "2Ã—32kg"
                }
            },
            {
                question: "The farmer's carry distance is 200m. If it is split into 4 equal parts, how long is each carry?",
                options: ["25m", "50m", "100m"],
                correct: "50m"
            },
            {
                question: "In the {{divisionLabel}} division, what is the sandbag weight?",
                options: {
                    women: ["6kg", "8kg", "10kg"],
                    men: ["10kg", "20kg", "30kg"],
                    mixed: ["10kg", "20kg", "30kg"]
                },
                correct: {
                    women: "10kg",
                    men: "20kg",
                    mixed: "20kg"
                }
            },
            {
                question: "The sandbag lunges cover 100m total. If split into 4 equal parts, how many meters does each effort represent?",
                options: ["20m", "25m", "50m"],
                correct: "25m"
            },
            {
                question: "In the {{divisionLabel}} division, what is the wall ball weight?",
                options: {
                    women: ["4kg", "6kg", "9kg"],
                    men: ["6kg", "9kg", "12kg"],
                    mixed: ["6kg", "9kg", "12kg"]
                },
                correct: {
                    women: "4kg",
                    men: "6kg",
                    mixed: "6kg"
                }
            },
            {
                question: "If you perform wall balls in sets of 10 and need to reach 50 reps total, how many sets are required?",
                options: ["4", "5", "10"],
                correct: "5"
            }
        ];

        let currentQuestion = null;

        window.addEventListener('load', () => {
            trackPage('home', 'CrÃ©ation de Challenge');
    
            const urlParams = new URLSearchParams(window.location.search);
            
            if (urlParams.has('recipient')) {
                challengeData.recipient = urlParams.get('recipient');
                challengeData.sender = urlParams.get('sender');
                challengeData.age = parseInt(urlParams.get('age')) || 0;
                challengeData.category = urlParams.get('category');
                challengeData.exercise = urlParams.get('exercise');

                trackEvent('challenge_created', {
                    exercise: challengeData.exercise,
                    category: challengeData.category,
                    has_age: challengeData.age > 0
                });
                loadChallengePage();
            }
        });

        document.getElementById('challengeForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            challengeData.recipient = document.getElementById('recipient').value;
            challengeData.sender = document.getElementById('sender').value;
            challengeData.age = parseInt(document.getElementById('age').value) || 0;
            challengeData.category = document.getElementById('category').value;
            challengeData.exercise = document.getElementById('exercise').value;
            
            const url = new URL(window.location.href.split('?')[0]);
            url.searchParams.set('recipient', challengeData.recipient);
            url.searchParams.set('sender', challengeData.sender);
            url.searchParams.set('age', challengeData.age);
            url.searchParams.set('category', challengeData.category);
            url.searchParams.set('exercise', challengeData.exercise);
            
            const linkContainer = document.getElementById('linkContainer');
            const generatedLink = document.getElementById('generatedLink');
            generatedLink.textContent = url.toString();
            linkContainer.classList.add('active');
            
            document.getElementById('challengeForm').style.display = 'none';
            linkContainer.scrollIntoView({ behavior: 'smooth' });
        });

        document.getElementById('copyBtn').addEventListener('click', function() {
            const linkText = document.getElementById('generatedLink').textContent;
            const textArea = document.createElement('textarea');
            textArea.value = linkText;
            textArea.style.position = 'fixed';
            textArea.style.left = '-9999px';
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            
            this.textContent = 'Copied! âœ“';
            setTimeout(() => {
                this.textContent = 'Copy Link';
            }, 2000);
        });
        
        function loadChallengePage() {
            document.querySelector('.home-page').classList.remove('active');
            document.querySelector('.challenge-page').classList.add('active');

            trackPage('challenge-quiz', 'Quiz Hyrox Challenge');
            
            const text = `Answer this question and discover the ${challengeData.exercise} challenge your partner ${challengeData.sender} sent you`;
            document.getElementById('challengeText').innerHTML = text;
            
            loadRandomQuestion();
            startTimers();
        }

        function loadRandomQuestion() {
            // Select random question
            const randomIndex = Math.floor(Math.random() * quizQuestions.length);
            currentQuestion = quizQuestions[randomIndex];
            
            // Get division label
            const divisionLabel = challengeData.category || 'mixed';
            
            // Set question text
            let questionText = currentQuestion.question.replace('{{divisionLabel}}', divisionLabel);
            document.getElementById('quizQuestion').textContent = questionText;
            
            // Get options based on category if needed
            let options, correctAnswer;
            if (typeof currentQuestion.options === 'object' && !Array.isArray(currentQuestion.options)) {
                options = currentQuestion.options[divisionLabel];
                correctAnswer = currentQuestion.correct[divisionLabel];
            } else {
                options = currentQuestion.options;
                correctAnswer = currentQuestion.correct;
            }
            
            // Create option buttons
            const optionsContainer = document.getElementById('quizOptions');
            optionsContainer.innerHTML = '';
            
            options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'quiz-option';
                button.textContent = option;
                button.setAttribute('data-answer', option);
                button.setAttribute('data-correct', correctAnswer);
                
                button.addEventListener('click', handleQuizAnswer);
                
                optionsContainer.appendChild(button);
            });
        }

        function handleQuizAnswer(e) {
            const selectedAnswer = e.target.getAttribute('data-answer');
            const correctAnswer = e.target.getAttribute('data-correct');
            
            if (selectedAnswer === correctAnswer) {
                // Stop timers
                clearInterval(timerInterval);
                clearInterval(penaltyInterval);
                
                // Add 15 seconds per penalty to Hyrox time
                hyroxSeconds += penalties.length * 15;
                
                showCompletionPage();
            } else {
                // Wrong answer - show message
                const messageEl = document.getElementById('funnyMessage');
                messageEl.textContent = 'Wrong answer! Try again...';
                messageEl.style.color = '#FF0000';
                
                setTimeout(() => {
                    messageEl.textContent = '';
                    messageEl.style.color = '#FFED00';
                }, 2000);
            }
        }

        function positionNoButton() {
            // No longer needed
        }

        function startTimers() {
            timerInterval = setInterval(() => {
                elapsedSeconds++;
                // Double the increment for penalties, but track time-based reps separately
                const doubledIncrement = exerciseConfig[challengeData.exercise].increment * 2;
                totalReps += doubledIncrement;
                
                cycleStep++;
                
                if (cycleStep === 1) {
                    const randomSec = Math.floor(Math.random() * 10) + 1;
                    hyroxSeconds += randomSec;
                } else if (cycleStep === 2) {
                    const randomMin = Math.floor(Math.random() * 3) + 1;
                    hyroxSeconds += randomMin * 60;
                } else if (cycleStep === 3) {
                    const randomSec = Math.floor(Math.random() * 41) + 10;
                    hyroxSeconds += randomSec;
                    cycleStep = 0;
                }
                
                updateHyroxTimer();
            }, 1000);

            // Add penalties every 2 seconds instead of 5
            penaltyInterval = setInterval(() => {
                addRandomPenalty();
            }, 2000);
        }

        function updateHyroxTimer() {
            const hours = Math.floor(hyroxSeconds / 3600);
            const minutes = Math.floor((hyroxSeconds % 3600) / 60);
            const seconds = hyroxSeconds % 60;
            
            const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('hyroxTimer').textContent = `YOUR NEXT HYROX RACE TIME: ${timeString}`;
        }

        function addRandomPenalty() {
            const penaltyTypes = [
                { type: 'time', value: 10, text: '+10 sec time' },
                { type: 'time', value: 15, text: '+15 sec time' },
                { type: 'reps', value: 10, text: `+10 ${challengeData.exercise}` },
                { type: 'reps', value: 15, text: `+15 ${challengeData.exercise}` }
            ];

            if (challengeData.age > 0) {
                penaltyTypes.push({
                    type: 'reps',
                    value: challengeData.age,
                    text: `+${challengeData.age} ${challengeData.exercise} (age bonus)`
                });
            }

            const penalty = penaltyTypes[Math.floor(Math.random() * penaltyTypes.length)];
            penalties.push(penalty);

            if (penalties.length > 5) {
                penalties.shift();
            }

            if (penalty.type === 'time') {
                hyroxSeconds += penalty.value;
                const repsFromTime = penalty.value * exerciseConfig[challengeData.exercise].increment;
                totalReps += repsFromTime;
                penaltyReps += repsFromTime;
            } else {
                totalReps += penalty.value;
                penaltyReps += penalty.value;
            }

            updatePenaltyBoard();
            updatePenaltyCounter();
        }

        function updatePenaltyBoard() {
            const penaltyList = document.getElementById('penaltyList');
            penaltyList.innerHTML = penalties.map(p => 
                `<div class="penalty-item">${p.text}</div>`
            ).join('');
        }

        function updatePenaltyCounter() {
            const unit = exerciseConfig[challengeData.exercise].unit;
            document.getElementById('penaltyCounter').textContent = `${penaltyReps} ${unit}`;
        }

        function showCompletionPage() {
            document.querySelector('.challenge-page').classList.remove('active');
            document.querySelector('.completion-page').classList.add('active');

            trackPage('completion', 'Challenge ComplÃ©tÃ©');
    
            trackEvent('challenge_completed', {
                exercise: challengeData.exercise,
                total_reps: totalReps,
                time_seconds: elapsedSeconds,
                penalty_reps: penaltyReps
            });
            const unit = exerciseConfig[challengeData.exercise].unit;
            
            // Calculate time-based reps using the ACTUAL elapsed seconds (not doubled)
            const timeBasedReps = elapsedSeconds * exerciseConfig[challengeData.exercise].increment;
            const correctTotal = timeBasedReps + penaltyReps;
            
            const text = `CONGRATS! It took you ${elapsedSeconds} seconds to find the right answer, ` +
                        `so you will do <span class="highlight">${timeBasedReps} ${unit}</span> of ${challengeData.exercise} ` +
                        `+ <span class="highlight">${penaltyReps} ${unit}</span> from penalties.<br>` +
                        `So a total of <span class="highlight">${correctTotal} ${unit}</span>! Good luck!`;
            
            document.getElementById('completionText').innerHTML = text;
            
            // Show final Hyrox time with prediction text
            const hours = Math.floor(hyroxSeconds / 3600);
            const minutes = Math.floor((hyroxSeconds % 3600) / 60);
            const seconds = hyroxSeconds % 60;
            const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            const shareText = `Based on your results, we predict your next Hyrox race time for you and your partner:<br> <span class="time-predicted">${timeString}</span>`;
            document.getElementById('shareLink').innerHTML = shareText;
        }

        document.getElementById('challengeBackBtn').addEventListener('click', () => {
            window.location.href = window.location.pathname;
        });
    </script>
</body>
</html>
